<!-- Loading -->
@if (isLoading) {
<be-loader />
} @else {
<!-- No data -->
@if (jobOffers.length === 0) {
<div class="empty-list row d-flex justify-content-center align-items-center flex-column">
    <div class="col-6">
        <p style="text-align: center;">
            {{ 'Recruiter.JobOffer.NoJobOfferMessage' | translate }}
        </p>
    </div>
    <div class="col-md-6 d-flex justify-content-center">
        <button class="btn btn-primary" (click)="openJobOfferModal(addJobOfferContent)">
            <i class="fa-solid fa-plus"></i>
            {{ 'Recruiter.JobOffer.AddJobOffer' | translate }}
        </button>
    </div>
</div>
} @else {
@if (!isViewingApplication) {
<div class="row mb-3">
    <div class="col-md-12 d-flex justify-content-end">
        <button class="btn btn-primary" (click)="openJobOfferModal(addJobOfferContent)">
            <i class="fa-solid fa-circle-plus me-2"></i>
            {{ 'Recruiter.JobOffer.AddJobOffer' | translate }}
        </button>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.Title' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.CompanyName' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.JobType' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.WorkplaceType' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.Salary' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobOffer.Table.IsActive' | translate }}</th>
                    <th scope="col">{{ 'Table.Actions' | translate }}</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                @for (jobOffer of jobOffers; track jobOffer.title; let i = $index) {
                <tr (click)="openJobOfferPreviewModal(previewJobOfferContent, jobOffer)">
                    <td>
                        {{ jobOffer.title }}
                    </td>
                    <td>
                        {{ jobOffer.companyName }}
                    </td>
                    <td>
                        {{ 'Enum.JobType.' + getJobTypeName(jobOffer.type) | translate }}
                    </td>
                    <td>
                        {{ 'Enum.WorkplaceType.' + getWorkplaceTypeName(jobOffer.workplaceType) | translate }}
                    </td>
                    <td>
                        {{ jobOffer.salary }}
                    </td>
                    <td>
                        <input class="form-check-input me-2" type="checkbox" [(ngModel)]="jobOffer.isActive" disabled>
                    </td>
                    <td>
                        <i class="action-icon fa-solid fa-pen me-4"
                            (click)="openJobOfferModal(updateJobOfferContent, jobOffer)"></i>
                        <i class="action-icon fa-solid fa-trash me-4"
                            (click)="openDeleteModal(deleteJobOfferContent, jobOffer)"></i>
                        <i class="action-icon fa-solid fa-user-group"
                            (click)="isViewingApplication = true; this.selectedJobOffer = jobOffer"></i>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
} @else {
<div class="row mb-3">
    <div class="col-md-6 d-flex justify-content-start">
        <button class="btn btn-primary" (click)="isViewingApplication = false">
            <i class="fa-solid fa-arrow-left me-2"></i>
            {{ 'BUTTON.BACK' | translate }}
        </button>
    </div>
    <div class="col-md-6 d-flex justify-content-end">
        {{ 'Recruiter.JobApplication.NumberOfApplications' | translate }} {{
        selectedJobOffer.jobApplications.length || 0 }}
    </div>
</div>
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">{{ selectedJobOffer.title }}</h5>
                <p class="card-text">
                    <strong>{{ 'Recruiter.JobOffer.Card.Company' | translate }} </strong> 
                    {{ selectedJobOffer.companyName }}<br>
                    <strong>{{ 'Recruiter.JobOffer.Card.Location' | translate }} </strong> 
                    {{ selectedJobOffer.location }}<br>
                    <strong>{{ 'Recruiter.JobOffer.Card.Salary' | translate }}</strong> 
                    {{ selectedJobOffer.salary }}<br>
                </p>
            </div>
        </div>
    </div>
</div>
<div class="row mb-4">
    <div class="col-12">
        <div ngbAccordion class="p-0">
            <div ngbAccordionItem #item="ngbAccordionItem">
                <h2 ngbAccordionHeader>
                    <button ngbAccordionButton>
                        <i class="fa-solid fa-filter me-2"></i> Filtre
                        <i class="fa-solid ms-auto" [ngClass]="item.collapsed ? 'fa-angle-down' : 'fa-angle-up'"></i>
                    </button>
                </h2>
                <div ngbAccordionCollapse>
                    <div ngbAccordionBody>
                        <ng-template>
                            <form [formGroup]="filterForm">
                                <div class="row mb-4">
                                    <!-- Left Column for Fields -->
                                    <div class="col-md-6">
                                        <!-- Title -->
                                        <label for="inputTitle" class="form-label">
                                            {{ 'Recruiter.JobOffer.Modal.Body.Form.Title' | translate }}
                                        </label>
                                        <input type="text" class="form-control" id="inputTitle" formControlName="title"
                                            [placeholder]="'Recruiter.JobOffer.Modal.Body.Form.TitlePlaceholder' | translate">
                                    </div>
                                    <div class="col-md-6">
                                        <!-- CompanyName -->
                                        <label for="inputCompanyName" class="form-label">
                                            {{ 'Recruiter.JobOffer.Modal.Body.Form.CompanyName' | translate }}
                                        </label>
                                        <input type="text" class="form-control" id="inputCompanyName"
                                            formControlName="companyName"
                                            [placeholder]="'Recruiter.JobOffer.Modal.Body.Form.CompanyNamePlaceholder' | translate">
                                    </div>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <!-- Job Type -->
                                        <label for="jobTypeSelect" class="form-label">
                                            {{ 'Recruiter.JobOffer.Modal.Body.Form.JobType' | translate }}
                                        </label>
                                        <select id="jobTypeSelect" class="form-select" formControlName="type">
                                            <option *ngFor="let jobType of jobTypesList" [ngValue]="jobType.key">
                                                {{ jobType.value | translate }}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <!-- Workplace Type -->
                                        <label for="workplaceTypeSelect" class="form-label">
                                            {{ 'Recruiter.JobOffer.Modal.Body.Form.WorkplaceType' | translate }}
                                        </label>
                                        <select id="workplaceTypeSelect" class="form-select"
                                            formControlName="workplaceType">
                                            <option *ngFor="let workplaceType of workplaceTypeList"
                                                [ngValue]="workplaceType.key">
                                                {{ workplaceType.value | translate }}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-9">
                                        <span *ngFor="let activeFilter of activeFilters"
                                            class="fs-6 badge bg-custom me-4 mt-2" (click)="deleteFilter(activeFilter.key)"
                                            style="cursor: pointer;">
                                            <span class="me-2">{{ activeFilter.value }}</span>
                                            <i class="fa-solid fa-circle-xmark"></i>
                                        </span>
                                    </div>
                                    <div class="col-3">
                                        <span class="float-end">
                                            <button type="button" class="btn btn-light" (click)="resetFilterForm()">
                                                <i class="fa-solid fa-arrow-rotate-left me-2"></i>
                                                Reset filters
                                            </button>
                                        </span>
        
                                    </div>
                                </div>
                            </form>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@if (selectedJobOffer.jobApplications.length === 0) {
<div class="empty-list row d-flex justify-content-center align-items-center flex-column">
    <div class="col-6">
        <h5 style="text-align: center;">
            {{ 'Recruiter.JobApplication.NoJobApplicationMessage' | translate }}
        </h5>
    </div>
</div>
}
@else {
<div class="row">
    <div class="col-md-12">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">{{ 'Recruiter.JobApplication.Table.FullName' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobApplication.Table.AppliedAt' | translate }}</th>
                    <th scope="col">{{ 'Recruiter.JobApplication.Table.Status' | translate }}</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                @for (jobApplication of selectedJobOffer.jobApplications; track jobApplication.id; let i = $index) {
                <tr (click)="openTalentPreviewModal(previewTalentContent, jobApplication)">
                    <th scope="row">
                        {{ i + 1 }}
                    </th>
                    <td>
                        @if (jobApplication.isExpress) {
                        {{ jobApplication.expressApplication?.lastName }} {{
                        jobApplication.expressApplication?.firstName }}
                        } @else {
                        {{ jobApplication.talentFullName }}
                        }
                    </td>
                    <td>
                        {{ jobApplication.appliedAt | date:'yyyy-MM-dd HH:mm:ss' }}
                    </td>
                    <td>
                        <span class="badge rounded-pill" [ngClass]="getStatusClass(jobApplication.status)">
                            {{ 'Enum.JobApplicationStatus.' + getJobApplicationStatus(jobApplication.status) |
                            translate }}
                        </span>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
}
}
}
}

<!-- Job offer preview modal -->
<ng-template #previewJobOfferContent let-c="close" let-d="dismiss">
    <app-job-offer-preview-modal [closeModal]="c" [dismissModal]="d"
        [selectedJobOffer]="selectedJobOffer"></app-job-offer-preview-modal>
</ng-template>

<!-- Job offer creation modal -->
<ng-template #addJobOfferContent let-c="close" let-d="dismiss">
    <app-job-offer-modal [closeModal]="c" [dismissModal]="d" (modalActionComplete)="modalActionComplete($event)" />
</ng-template>

<!-- Job offer edit modal -->
<ng-template #updateJobOfferContent let-c="close" let-d="dismiss">
    <app-job-offer-modal [closeModal]="c" [dismissModal]="d" [selectedJobOffer]="selectedJobOffer"
        (modalActionComplete)="modalActionComplete($event)" />
</ng-template>

<!-- Job offer delete modal -->
<ng-template #deleteJobOfferContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title">
            {{ 'Recruiter.JobOffer.Modal.DeleteTitle' | translate }}
        </h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <p>
            {{ 'Recruiter.JobOffer.Modal.Body.DeleteMessage' | translate }}
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="deleteJobOffer()">
            <i class="me-2" [ngClass]="{'fa fa-spin fa-spinner': isSaving, 'fa-solid fa-trash': !isSaving }"></i>
            {{ 'BUTTON.DELETE' | translate }}
        </button>
    </div>
</ng-template>

<!-- Job offer reject Modal -->
<ng-template #rejectJobApplicationModal let-modal>
    <form [formGroup]="rejectionForm" (ngSubmit)="rejectJobApplication()">
        <div class="modal-header">
            <h4 class="modal-title">
                {{ 'Recruiter.JobApplication.RejectModal.Title' | translate }}
            </h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <label for="inputRejectionReason" class="form-label">
                {{ 'Recruiter.JobApplication.RejectModal.Reason' | translate }}
            </label>
            <textarea rows="5" class="form-control" id="inputRejectionReason" #inputRejectionReason
                formControlName="reason"></textarea>
            @if(rejectionForm.controls['reason'].touched && rejectionForm.controls['reason'].invalid) {
            <app-error-message [message]="'Recruiter.JobApplication.RejectModal.Validation.Reason'" />
            }
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-danger">
                <i class="me-2" [ngClass]="{'fa fa-spin fa-spinner': isSaving, 'fa-solid fa-trash': !isSaving }"></i>
                {{ 'Recruiter.JobApplication.RejectModal.Reject' | translate }}
            </button>
        </div>
    </form>
</ng-template>

<!-- Talent Preview Modal -->
<ng-template #previewTalentContent let-c="close" let-d="dismiss">
    <app-talent-preview-modal [closeModal]="c" [dismissModal]="d" [selectedTalentId]="selectedTalentId"
        [jobApplication]="selectedJobApplication" (modalActionComplete)="talentPreviewModalCloased($event)">
    </app-talent-preview-modal>
</ng-template>